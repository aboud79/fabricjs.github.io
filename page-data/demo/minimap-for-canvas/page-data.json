{"componentChunkName":"component---src-templates-demo-jsx","path":"/demo/minimap-for-canvas/","result":{"data":{"demoPage":{"html":"<p>This tutorial is still a work in progress.\r\nThis tutorial show some concepts on how to build a minimap for a large canvas.</p>\n<p>The main thing to take in account is to display the same set of objects on 2 different canvas with 2 different size and zoom level. To do this we will render the whole design as an image and use it as background in the minimap.</p>\n<p>This is a cache killer, so we will disable the <code class=\"language-text\">objectCaching</code> for this example, as of today there is not really a codepath that lets you draw object at 2 zoom level and keep the cache alive.</p>\n<p>We will add on the minimap a rect that will be our indicator of the viewport.</p>\n<h2 id=\"setting-up-the-idea\" style=\"position:relative;\">Setting up the idea<a href=\"#setting-up-the-idea\" aria-label=\"setting up the idea permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>We are going to create to canvases, on purposes both with a different aspect ratio and both different from the design aspect ratio.</p>\n<p>The small one for the minimap will be positioned on top of the bigger one.</p>\n<p>The inputs on the small one will generate events to manipulate the zoom on the bigger one.</p>\n<div\r\n  class=\"codepen-later\"\r\n  data-editable=\"true\"\r\n  data-height=\"500\"\r\n  data-default-tab=\"result\"\r\n  data-prefill='{\r\n    \"scripts\": [\"https://unpkg.com/fabric@4.0.0-beta.12/dist/fabric.js\", \"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.js\"]\r\n  }'\r\n>\r\n<pre data-lang=\"css\" data-options-autoprefixer=\"true\">\r\n  .minimap {\r\n  \tborder: 1px solid blue;\r\n    position: absolute !important;\r\n    top: 20px;\r\n    left: 20px;\r\n  }\r\n  .design {\r\n    border: 1px solid black;\r\n  }\r\n</pre>\r\n<pre data-lang=\"html\">\r\n  <canvas id=\"design\" width=\"500\" height=\"400\" ></canvas>\r\n  <canvas id=\"minimap\" width=\"130\" height=\"130\" style=\"position: absolute; top: 10px; left: 10px;\"></canvas>\r\n</pre>\r\n<pre data-lang=\"js\">\n<p>fabric.Object.prototype.objectCaching = false;</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var design = new fabric.Canvas('design', { containerClass: 'design' });</code></pre></div>\n<p>var minimap = new fabric.Canvas('minimap',  { containerClass: 'minimap', selection: false });</p>\n<p>design.loadFromJSON({\"version\":\"3.6.3\",\"objects\":[{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":513,\"top\":160,\"width\":50,\"height\":50,\"fill\":\"#8d476b\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":174,\"top\":166,\"width\":100,\"height\":100,\"fill\":\"#383881\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":330,\"top\":242,\"width\":50,\"height\":50,\"fill\":\"#c8eff0\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":328,\"top\":300,\"width\":150,\"height\":100,\"stroke\":\"#98d727\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":44,\"top\":257,\"width\":385,\"height\":245,\"fill\":\"#6aefb4\",\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"textbox\",\"version\":\"3.6.3\",\"left\":254,\"top\":195,\"width\":300,\"height\":75.03,\"fill\":\"#049c82\",\"angle\":-9,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor \",\"fontSize\":20,\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"minWidth\":20,\"splitByGrapheme\":false,\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":348,\"top\":326,\"width\":598.13,\"height\":150.06,\"fill\":\"#d15803\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":3,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":32,\"top\":438,\"width\":598.13,\"height\":254.93,\"fill\":\"#69c5c5\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":4,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna aliqua.\\nUt enim ad mini\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":175,\"top\":105,\"width\":50,\"height\":50,\"fill\":\"#761c05\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":187,\"top\":6,\"width\":100,\"height\":100,\"fill\":\"#360560\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":284,\"top\":390,\"width\":50,\"height\":50,\"fill\":\"#fe047d\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":290,\"top\":434,\"width\":150,\"height\":100,\"stroke\":\"#ad7cee\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":20,\"top\":249,\"width\":385,\"height\":245,\"fill\":\"#3a41a7\",\"scaleX\":0.55,\"scaleY\":0.55,\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"textbox\",\"version\":\"3.6.3\",\"left\":269,\"top\":27,\"width\":300,\"height\":153.68,\"fill\":\"#e19e54\",\"angle\":-1,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna aliqua.\\nUt enim ad minim veniam,\\nquis no\",\"fontSize\":20,\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"minWidth\":20,\"splitByGrapheme\":false,\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":391,\"top\":296,\"width\":493.52,\"height\":97.63,\"fill\":\"#d63098\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-10,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur \",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":330,\"top\":544,\"width\":371.25,\"height\":45.2,\"fill\":\"#4d690c\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":5,\"text\":\"Lorem ipsum dolor si\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":100,\"top\":66,\"width\":50,\"height\":50,\"fill\":\"#1b39bb\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":266,\"top\":98,\"width\":100,\"height\":100,\"fill\":\"#4f8af4\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":119,\"top\":152,\"width\":50,\"height\":50,\"fill\":\"#6d16e6\",\"opacity\":0.8},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":365,\"top\":237,\"width\":493.52,\"height\":97.63,\"fill\":\"#44c459\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-2,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectet\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":220.87,\"top\":288.28,\"width\":598.13,\"height\":202.5,\"fill\":\"#42cf3f\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":12.72,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do eiusmod tempor incididunt\\nut labore et dolore magna al\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":0,\"top\":127,\"width\":100,\"height\":100,\"fill\":\"#9e4b3c\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":530,\"top\":16,\"width\":50,\"height\":50,\"fill\":\"#a209e7\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":88,\"top\":211,\"width\":50,\"height\":50,\"fill\":\"#20286e\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":27,\"top\":237,\"width\":150,\"height\":100,\"stroke\":\"#5e9fb3\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":371,\"top\":447,\"width\":100,\"height\":100,\"fill\":\"#5ec5ba\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"i-text\",\"version\":\"3.6.3\",\"left\":376,\"top\":444,\"width\":493.52,\"height\":150.06,\"fill\":\"#ecb2cc\",\"scaleX\":0.5,\"scaleY\":0.5,\"angle\":-1,\"text\":\"Lorem ipsum dolor sit amet,\\nconsectetur adipisicing elit,\\nsed do ei\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":492,\"top\":505,\"width\":50,\"height\":50,\"fill\":\"#9fa139\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":559,\"top\":527,\"width\":50,\"height\":50,\"fill\":\"#d5eb95\",\"opacity\":0.8},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":566,\"top\":90,\"width\":50,\"height\":50,\"fill\":\"#d3d188\",\"opacity\":0.8},{\"type\":\"polygon\",\"version\":\"3.6.3\",\"left\":834.66,\"top\":241.24,\"width\":385,\"height\":245,\"fill\":\"#9580bf\",\"scaleX\":0.68,\"scaleY\":0.68,\"angle\":140,\"points\":[{\"x\":185,\"y\":0},{\"x\":250,\"y\":100},{\"x\":385,\"y\":170},{\"x\":0,\"y\":245}]},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":643,\"top\":16,\"width\":50,\"height\":50,\"fill\":\"#c1b138\",\"scaleX\":2.64,\"scaleY\":2.64,\"opacity\":0.8},{\"type\":\"text\",\"version\":\"3.6.3\",\"left\":389,\"top\":360,\"width\":22.25,\"height\":45.2,\"fill\":\"#d6a02d\",\"scaleX\":0.5,\"scaleY\":0.5,\"text\":\"L\",\"fontWeight\":\"\",\"fontFamily\":\"helvetica\",\"styles\":{}},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":625,\"top\":350,\"width\":50,\"height\":50,\"fill\":\"#908f9f\",\"opacity\":0.8},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":603,\"top\":454,\"width\":100,\"height\":100,\"fill\":\"#578b25\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":681,\"top\":388,\"width\":100,\"height\":100,\"fill\":\"#990621\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":676,\"top\":491,\"width\":100,\"height\":100,\"fill\":\"#c2d944\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"circle\",\"version\":\"3.6.3\",\"left\":644,\"top\":53,\"width\":100,\"height\":100,\"fill\":\"#c1532e\",\"opacity\":0.8,\"radius\":50,\"startAngle\":0,\"endAngle\":6.283185307179586},{\"type\":\"triangle\",\"version\":\"3.6.3\",\"left\":601,\"top\":434,\"width\":50,\"height\":50,\"fill\":\"#54cd04\",\"opacity\":0.8},{\"type\":\"line\",\"version\":\"3.6.3\",\"left\":435,\"top\":198,\"width\":150,\"height\":100,\"stroke\":\"#d08d13\",\"x1\":-75,\"x2\":75,\"y1\":-50,\"y2\":50},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":101,\"top\":12,\"width\":50,\"height\":50,\"fill\":\"#7a7d9c\",\"opacity\":0.8},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":14,\"top\":7,\"width\":50,\"height\":50,\"fill\":\"#16c0ef\",\"opacity\":0.8},{\"type\":\"rect\",\"version\":\"3.6.3\",\"left\":22,\"top\":74.17,\"width\":50,\"height\":50,\"fill\":\"#8a4cde\",\"angle\":355.3,\"opacity\":0.8}]}, function() {\r\ninitMinimap();\r\nupdateMiniMapVP();\r\n});</p>\n<p>function createCanvasEl() {\r\nvar designSize = { width: 800, height: 600 };\r\nvar originalVPT = design.viewportTransform;\r\n// zoom to fit the design in the display canvas\r\nvar designRatio = fabric.util.findScaleToFit(designSize, design);</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// zoom to fit the display the design in the minimap.\r\nvar minimapRatio = fabric.util.findScaleToFit(design, minimap);\r\n\r\nvar scaling = minimap.getRetinaScaling();\r\n\r\nvar finalWidth =  designSize.width * designRatio;\r\nvar finalHeight =  designSize.height * designRatio;\r\n\r\ndesign.viewportTransform = [\r\n  designRatio, 0, 0, designRatio,\r\n  (design.getWidth() - finalWidth) / 2,\r\n  (design.getHeight() - finalHeight) / 2\r\n];\r\nvar canvas = design.toCanvasElement(minimapRatio * scaling);\r\ndesign.viewportTransform = originalVPT;\r\nreturn canvas;</code></pre></div>\n<p>}</p>\n<p>function updateMiniMap() {\r\nvar canvas = createCanvasEl();\r\nminimap.backgroundImage._element = canvas;\r\nminimap.requestRenderAll();\r\n}</p>\n<p>function updateMiniMapVP() {\r\nvar designSize = { width: 800, height: 600 };\r\nvar rect = minimap.getObjects()[0];\r\nvar designRatio = fabric.util.findScaleToFit(designSize, design);\r\nvar totalRatio = fabric.util.findScaleToFit(designSize, minimap);\r\nvar finalRatio = designRatio / design.getZoom();\r\nrect.scaleX = finalRatio;\r\nrect.scaleY = finalRatio;\r\nrect.top = minimap.backgroundImage.top - design.viewportTransform[5] * totalRatio / design.getZoom();\r\nrect.left = minimap.backgroundImage.left - design.viewportTransform[4] * totalRatio / design.getZoom();\r\nminimap.requestRenderAll();\r\n}</p>\n<p>function initMinimap() {\r\nvar canvas = createCanvasEl();\r\nvar backgroundImage = new fabric.Image(canvas);\r\nbackgroundImage.scaleX = 1 / design.getRetinaScaling();\r\nbackgroundImage.scaleY = 1 / design.getRetinaScaling();\r\nminimap.centerObject(backgroundImage);\r\nminimap.backgroundColor = 'white';\r\nminimap.backgroundImage = backgroundImage;\r\nminimap.requestRenderAll();\r\nvar minimapView = new fabric.Rect({\r\ntop: backgroundImage.top,\r\nleft: backgroundImage.left,\r\nwidth: backgroundImage.width / design.getRetinaScaling(),\r\nheight: backgroundImage.height/ design.getRetinaScaling(),\r\nfill: 'rgba(0, 0, 255, 0.3)',\r\ncornerSize: 6,\r\ntransparentCorners: false,\r\ncornerColor: 'blue',\r\nstrokeWidth: 0,\r\n});\r\nminimapView.controls = {\r\nbr: fabric.Object.prototype.controls.br,\r\n};\r\nminimap.add(minimapView);\r\n}</p>\n<p>var debouncedMiniMap = _.debounce(updateMiniMap, 250);</p>\n<p>design.on('object:modified', function() {\r\nupdateMiniMap();\r\n})</p>\n<p>// hook up the pan and zoom\r\ndesign.on('mouse:wheel', function(opt) {\r\nvar delta = opt.e.deltaY;\r\nvar zoom = design.getZoom();\r\nzoom *= 0.999 ** delta;\r\nif (zoom > 20) zoom = 20;\r\nif (zoom &#x3C; 0.01) zoom = 0.01;\r\nthis.setZoom(zoom);\r\nupdateMiniMapVP();\r\nopt.e.preventDefault();\r\nopt.e.stopPropagation();\r\n});\r\ndesign.on('mouse:down', function(opt) {\r\nvar evt = opt.e;\r\nif (evt.altKey === true) {\r\nthis.isDragging = true;\r\nthis.selection = false;\r\nthis.lastPosX = evt.clientX;\r\nthis.lastPosY = evt.clientY;\r\n}\r\n});\r\ndesign.on('mouse:move', function(opt) {\r\nif (this.isDragging) {\r\nvar e = opt.e;\r\nvar vpt = this.viewportTransform;\r\nvpt[4] += e.clientX - this.lastPosX;\r\nvpt[5] += e.clientY - this.lastPosY;\r\nthis.requestRenderAll();\r\nupdateMiniMapVP();\r\nthis.lastPosX = e.clientX;\r\nthis.lastPosY = e.clientY;\r\n}\r\n});\r\ndesign.on('mouse:up', function(opt) {\r\nthis.isDragging = false;\r\nthis.selection = true;\r\n});\r\n</pre></p>\n</div>","frontmatter":{"title":"Build a minimap for canvas"},"mdFile":{"relativePath":"demo/minimap-for-canvas/index.md"}}},"pageContext":{"title":"Build a minimap for canvas","slug":"/demo/minimap-for-canvas","prev":{"title":"Animation easing","slug":"/demo/animation-easing"},"next":{"title":"Clipping and masking","slug":"/demo/clipping"}}},"staticQueryHashes":["2748212769"],"slicesMap":{}}