<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.8.1"/><style data-href="/styles.9e43de4415f1ad1076db.css" data-identity="gatsby-global-css">:root{--primary-color:#76cef4;--primary-color-tint:#f0f8ff;--offwhite-color:#fafafa;--padding-left-right:8%;--padding-above:15%;--font-size-smaller2:13px;--font-size-smaller:14px;--font-size-normal:16px;--font-size-bigger:18px;--font-size-bigger2:20px;--font-size-bigger3:24px;--font-color-light2:#7b93ab;--font-color-light:#5a7896;--font-color-normal:#445a71;--font-color-dark:#2d3c4b;--font-color-dark2:#171e26;--border-radius-normal:6px;--header-height:0;--bottom-nav-height:50px}@media (min-width:800px) and (orientation:landscape){:root{--padding-left-right:10%;--padding-above:8%;--font-size-smaller2:15px;--font-size-smaller:16px;--font-size-normal:18px;--font-size-bigger:21px;--font-size-bigger2:26px;--font-size-bigger3:32px;--header-height:65px}body{margin-bottom:0}}*{box-sizing:border-box}::selection{background-color:transparent}html{height:100%}body{background-color:#fff;color:var(--font-color-normal);cursor:default;direction:ltr;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,century gothic,sans-serif;font-size:var(--font-size-normal);font-weight:400;line-height:1.6;margin:0;margin-bottom:var(--bottom-nav-height);margin-top:var(--header-height);padding:0}a{color:var(--primary-color);text-decoration:none}:active,a:active{outline:none}:focus,a:focus{outline:0;outline-style:none}a img{border:0}ul{list-style-type:none;margin:0;padding:0}h1,h2{color:var(--font-color-dark2);font-weight:600}h1{font-size:var(--font-size-bigger3)}h2{font-size:var(--font-size-bigger2)}h3{color:var(--font-color-dark)}.darkBg{background-color:var(--offwhite-color)}main>#breadcrumb-nav{font-size:var(--font-size-smaller2);margin:0;padding:5px var(--padding-left-right)}main>*{margin:0;padding:20px var(--padding-left-right)}main>h1{position:relative;text-align:center}main>article>h2{border-left:3px solid var(--primary-color);margin:var(--padding-above) 0 3% 0;padding:0 0 0 20px}main>article>h2:first-child{margin-top:3%}main>article>h2:hover>a:before{content:"ðŸ”—";font-weight:400;margin-left:10px}main>article p{text-align:justify}main>article>p:first-child{margin-top:0}main>article>p>strong{color:var(--font-color-dark);font-weight:600}main>article>p>img{max-width:100%}article a{border-bottom:1px dashed var(--primary-color)}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}#site-header{background:#fff;display:block;font-size:16px;line-height:1;z-index:9}#logo{align-self:flex-start;display:block;text-align:center}#site-header>nav{bottom:0;height:var(--bottom-nav-height);position:fixed;right:0;width:100%;z-index:999}#site-header>nav:before{background:linear-gradient(180deg,transparent 0,rgba(0,0,0,.15));bottom:0;content:"";height:80px;left:0;pointer-events:none;position:fixed;right:0;z-index:-1}#site-header>nav>ul{background-color:#fff;border-radius:15px 15px 0 0;box-shadow:0 -2px 10px rgba(0,0,0,.2);display:flex;justify-content:space-around;padding:0 20px;width:100%}#site-header>nav>ul>li>a{color:var(--font-color-normal);display:block;font-size:var(--font-size-smaller2);height:var(--bottom-nav-height);padding:12px 0}#site-header>nav>ul>li>a.active{box-shadow:0 3px 0 0 var(--primary-color) inset;color:var(--primary-color)}#site-header>nav>ul>li>a:hover{color:var(--primary-color)}@media (orientation:landscape){#site-header>nav{width:300px}#site-header>nav>ul{border-radius:30px 0 0}}@media (min-width:800px) and (orientation:landscape){#site-header{align-items:center;background:#fff;display:flex;flex-flow:row nowrap;height:var(--header-height);justify-content:space-between;left:0;padding:0 var(--padding-left-right);position:fixed;top:0;width:100%;z-index:9}#site-header>nav{background-color:unset;height:unset;position:unset;width:50%}#site-header>nav:before{display:none}#site-header>nav>ul{background-color:unset;border-radius:unset;box-shadow:unset;justify-content:space-between;padding:0}#site-header>nav>ul>li>a{font-size:unset;height:var(--header-height);padding:24px 0}#site-header>nav>ul>li>a.active{box-shadow:0 -3px 0 0 var(--primary-color) inset;color:var(--font-color-dark2)}}#carbonads,#gentle-reminder{position:fixed;right:5px;top:70px;width:144px}.reminder{background-color:pink!important;color:#fff;font-size:13px;padding:2px;text-align:center}#carbonads{background:#333;display:block;font-family:Verdana,Helvetica Neue,Helvetica,sans-serif;font-size:.9em;line-height:1.5;margin:1px;overflow:hidden;padding:3px}#carbonads a{color:#ffbfcb!important;margin:0;padding:0!important;text-decoration:none!important}#carbonads span{margin:0;overflow:hidden}#carbonads span,.carbon-img{display:block;padding:0!important}.carbon-img{margin:0 0 1em}.carbon-img img{display:block;margin:1px;padding:0}.carbon-text{display:block;margin:0 0 1em;padding:0;text-align:left}.carbon-poweredby{display:block;font-size:.8em;margin:0;padding:0;text-align:right}#featuredBanner{background-color:var(--primary-color);height:70vh;position:relative}h1>span{font-size:.6em}#featuresList{display:flex;flex-wrap:wrap;justify-content:center}#featuresList h2{border-bottom:2px solid #000;margin:0 44px;padding-bottom:10px}#featuresList .col{max-width:50%;padding:0 10px;text-align:center;width:300px}.canvas-banner{left:0;position:absolute;top:0}.horizontalPanCntnr{cursor:ew-resize;overflow-x:hidden;-webkit-user-select:none;-o-user-select:none;user-select:none}ul.horizontalPanList{text-align:center;white-space:nowrap;width:100%}ul.horizontalPanList>li{display:inline-block;padding:10px;vertical-align:top;width:70%}@media (min-width:600px) and (orientation:landscape){ul.horizontalPanList>li{width:40%}}@media (min-width:800px) and (orientation:landscape){ul.horizontalPanList>li{width:30%}}.team-member{align-items:center;display:flex}.team-member img{display:inline-block;height:300px;padding:8px}.team-member .content{display:flex;flex-direction:column;padding:8px}.svg-row{border:1px solid var(--font-color-light2);flex-direction:row}.svg-block,.svg-row{display:flex;margin:8px}.svg-block{align-items:center;flex-direction:column;justify-content:flex-start;width:33%}.svg-block canvas,.svg-block img,.svg-block svg{max-height:auto;max-width:100%}ul.thumbList{background-color:var(--offwhite-color);padding:30px var(--padding-left-right)}ul.thumbList>li{display:block}ul.thumbList>li+li{padding-top:20px}ul.thumbList>li>*{width:100%}@media (min-width:400px){ul.thumbList{align-items:stretch;display:flex;flex-direction:row;flex-wrap:wrap}ul.thumbList>li{display:flex;vertical-align:top;width:50%}ul.thumbList>li+li{padding-top:unset}ul.thumbList>li:nth-of-type(odd){padding:5px 5px 5px 0}ul.thumbList>li:nth-of-type(2n){padding:5px 0 5px 5px}}@media (min-width:800px) and (orientation:landscape){ul.thumbList>li{padding:10px!important;width:25%}}.card{background-color:#fff;border:1px solid #eef;border-radius:4px;padding:20px;position:relative}.card:after{border:1px dashed var(--primary-color);bottom:10px;content:"";display:block;left:10px;opacity:.5;pointer-events:none;position:absolute;right:10px;top:10px}.thumbCntnr{display:block;height:0;overflow:hidden;padding-bottom:60%;position:relative}.thumbCntnr>.gatsby-image-wrapper{height:auto;left:0;position:absolute!important;top:50%;transform:translateY(-50%);width:100%}.card h4{display:block;font-size:var(--font-size-smaller2);margin:0;padding:0}.card span.desc{color:var(--font-color-normal);display:block;font-size:14px;line-height:1.2;margin-top:5px;text-align:justify}.contributorCard{text-align:center}.contributorCard>img{border-radius:100px;width:90%}.contributorsList>ul>li{width:40%}@media (min-width:600px) and (orientation:landscape){.contributorsList>ul>li{width:22%}}@media (min-width:800px) and (orientation:landscape){.contributorsList>ul>li{width:8%}}#features{align-items:center;display:flex;flex-direction:column;justify-content:center}#features h2{display:block;font-size:40px}#features .features-list{display:flex;flex-direction:row;width:100%}#features .column-left li{align-items:flex-end;display:flex;flex-direction:column}#features .column-left{padding-left:0;padding-right:25px}#features .column-left,#features .column-right{display:flex;flex-direction:column;list-style:none;width:50%}#features .column-right{align-items:flex-start;padding-left:25px;padding-right:0}:root{--left-sidebar-width:85%}@media (min-width:400px){:root{--left-sidebar-width:300px}}@media (min-width:800px) and (orientation:landscape){:root{--left-sidebar-width:20%}}#sidebarLeft{bottom:0;left:0;position:fixed;top:0;transition:left .2s ease;width:var(--left-sidebar-width);z-index:999}#sidebarLeft.closed{left:-85%}#sidebarLeftModalBg{background-color:#000;bottom:0;left:0;opacity:0;pointer-events:none;position:fixed;right:0;top:0;transition:opacity .3s linear;z-index:-1}#sidebarLeft.open>#sidebarLeftModalBg{opacity:.4;pointer-events:all}#sidebarLeftModalBg+button{background-color:#fff;border:1px solid rgba(0,0,0,.2);border-radius:0 var(--border-radius-normal) var(--border-radius-normal) 0;bottom:var(--bottom-nav-height);box-shadow:2px 0 15px rgba(0,0,0,.25);cursor:pointer;height:50px;left:100%;margin-bottom:20px;position:absolute;width:50px}#sidebarLeftModalBg+button:before{content:">"}#sidebarLeft.open>#sidebarLeftModalBg+button:before{content:"<"}#sideBarLeftContentWrap{background-color:#fff;bottom:0;overflow:auto;padding:10%;position:absolute;top:0;width:100%}@media (min-width:400px){#sidebarLeft.closed{left:-300px}}@media (orientation:landscape){#sidebarLeftModalBg+button{border-radius:0 30px 0 0;bottom:0;margin-bottom:unset}}@media (min-width:800px) and (orientation:landscape){#sidebarLeft,#sidebarLeftModalBg{top:var(--header-height)}#sidebarLeft.closed{left:unset}#sidebarLeftModalBg,#sidebarLeftModalBg+button{display:none}#sideBarLeftContentWrap{border-right:1px solid #eee}#sidebarLeft~footer,#sidebarLeft~main{margin-left:var(--left-sidebar-width)}}#sideBarLeftContentWrap>header{color:var(--font-color-light2);font-size:var(--font-size-smaller2)}#topics{margin-bottom:10%}#topics>ol{list-style:none;margin:0;padding:0}#topics>ol>li a{border-radius:var(--border-radius-normal);color:var(--font-color-normal);display:block;font-size:var(--font-size-smaller);line-height:1.2;padding:6px 10px;position:relative}#topics>ol>li a:hover{background-color:var(--primary-color-tint)}#topics>ol>li a.active,#topics>ol>li a:hover{color:var(--primary-color)}#topics>ol>li>a.active{font-weight:600;position:relative}#topics>ol>li>a.active:before{background-color:var(--primary-color);border-radius:0 20px 20px 0;content:"";height:4px;margin-right:10px;margin-top:-2px;position:absolute;right:100%;top:50%;width:40px}#table-of-contents>ul{border-left:1px solid #eee;margin:0 0 16px 16px;padding-left:8px}#table-of-contents>ul>li>a{font-size:var(--font-size-smaller2);line-height:1.1}main>#prevNextPostLinks{padding:2% var(--padding-left-right)}#prevNextPostLinks>ul{border-top:1px solid #eee;padding-top:2%}#prevNextPostLinks>ul>li{display:block}li.nextPost{text-align:right}li.nextPost:before,li.prevPost:before{color:var(--font-color-dark);display:block;font-size:var(--font-size-smaller)}li.prevPost:before{content:"Previous"}li.nextPost:before{content:"Next"}#prevNextPostLinks>ul>li>a{position:relative}#prevNextPostLinks>ul>li>a:hover:before{background-color:var(--primary-color-tint);border-radius:var(--border-radius-normal);bottom:-5px;content:"";left:-10px;padding:5px 10px;position:absolute;right:-10px;top:-5px;z-index:-1}@media (min-width:480px) and (orientation:landscape){#prevNextPostLinks>ul>li{display:inline-block;width:50%}li.prevPost{float:left}li.nextPost{float:right}#prevNextPostLinks>ul:after{clear:both;content:"";display:block}}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header id="site-header"><a id="logo" href="/"><img alt="FabricJS logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAAAyCAMAAAD7nbCeAAAAPFBMVEVHcEx2zvR20PR7k6t2zvR2zvR7k6t6or17k6t7k6t43fH///9zvvl1yPea4Pd66O5ytPzf9P2T0Pq46PohTQEQAAAACnRSTlMAl///eMiaPcd4cxaYewAABFpJREFUaN7NmOFiqyAMhVuqohaowPu/6yVAQhB02487Rjc61NWvh5MQeQhqO7x4+8CrbY9RTegTrCik4bcDOw5VeGugs14IY601+x56v+/hkN0/8dDnA+eh9wNRtbDeCeGMCcB76IOWoQ+SfuIA+iClSW/ejkTVxl1aoJ3/oapqodGvextcn72JrYGomkXWfhY2gu5/BdW7gKpPrFxalrTMWANYdxL2rCqzgLF/AbXOr7VliXYwqneaybq3yxYPrbEGSK3oCkmfNX92wThUlUkJ9H1uHjPBYFSlnWbK+nenmaKrGR5W6IAu6duSrEPDSilLsgr37jefQmsfjAqqqsxqL1GzroNVLV4totqLLDDUq0pp+Imo6FRrTu3DCoKRqIlUMVTTNL4WDA0rlNVfiEqq7saORtXpZRHV9VWFsNp3/t8rb/L00TIcW3r33F6v13YFNM3zM/37cxZCzFNXVXupqiiqVqgv3hrUcGz9OWrAg/cnVU+SUI1WKjkWUX1pqGpm/fjfQp0Acp5nxqrUkQJLddOqp/mnYutXUCWAwgfGP9KZQykUVXVQs6q8LDyjyqubXqLetoQ6kZjyOclLA/DVn+Y/wfYMUKFuK/AtDHUJ3YYxuIThFi5a86HHstLlDep0zgAHhFUUtYPqEVUkC/TCStYzW8wQUdc4XPLF6wJTTwag67ceqpB91K6qns2/uMoAsh5muIyKY5lRXxxV9nxOXtVCzDT5yauI2qhKSas8cvdQc1YN914yQr63zHptWVZSEFHjl9jkUnk6Z4AZU1VJrMehDnVUqDanKWfyWkDPhncZAJi2Jd5yZah4FV68lQywoZwrlxXz6izOiVUdREqoLjYENfR0mHivUVMwyY2hcnQybUYlNeW2yWYJCMsWsaKqTqGuhBoJI6ujHa1s1nvUbWXm66FKhrp2kxmhwnfIuFNGtQ44j1ZVZxzOfpQ0PiTehVWOo+VG1cePUHGBnQtqq2qefufYBsFFWBVUvPc3Ue8NIMsOcIV6RBNkVI+SAijbz/pS1VOYECoLK4664YEqrJ5AJmc0aER9klePHFs2i6qdo0du2iBIbjViv0TF5CR5spJ1sqpqgBxnW2WEGazJVv4n8yo0FXVNqBofDJp9l8R7r+prWXhY4Vj2UJfTEjBNU6xRZS4B5zzGcuUosIBqNRVaqrCy/Vdx79W8emZUzAjLo4daWBecaoHTXcpVirLj8A5h7dsaKrOQVFT7Wf4ONd16wRmXcG4tJC1qTm74/FCtTvLZrlYxrEDV9Es1oVatrsbWqG3hJ79zqDorq4F8XA4R9cgZ60BVuV1J1y9R/2crBiBaZgGla12dH4rKOVntkmi5BzRfkMeioqxHE1qVXweiOsVJmaocVyRYZ4aiWh8AoT4JmKFXsQdGGGjoYefNGRdI/eCwghTgrfUB2Fqos6y1RikT3pSKh7SG81ob6/+OV4sVkhGqrCVi7fKXUFl+Pa+xULuMIv0H70KFD/dlzwIAAAAASUVORK5CYII="/></a><nav><ul><li><a href="/">Home</a></li><li><a href="/demos/">Demos</a></li><li><a href="/docs/">Docs</a></li><li><a href="/customize-build/">Customize build</a></li><li><a href="/support/">Support</a></li><li><a href="/team/">Team</a></li></ul></nav></header><div></div><main><nav id="breadcrumb-nav" aria-label="breadcrumb"><a href="/demos/">Demos</a> &gt; <span>Custom controls for polygon</span></nav><h1>Custom controls for polygon</h1><article><p>This demo shows how to use the controls api to do something like changing the shape of a polygon.
This is generally harder to grasp because require understanding the internal polygon logic,
anchor points and transformations.</p>
<p>In the demo the canvas has zoom and translation, so we are sure our code is generic enough.
The polygon is given some big strokeWidth for the same reason.</p>
<p>We have a function that trigger the <code class="language-none">edit mode</code>.
When we enter in edit mode we create one new control for each polygon point.
To those controls we attach a property, called point index, to remember to which point they are bound to.</p>
<p>Those controls use their own custo position handler: <code class="language-none">polygonPositionHandler</code>. This function
look at the pointIndex of the control and return the current canvas position for that particular point.
In this way interaction and rendering are done.</p>
<p>To make the actual control change the current point, we need to write a custom action handler.</p>
<p>Changing a point position is actually easy:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">=</span> number
fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">=</span> number</code></pre></div>
<p>The hard part is handling the object that change dimensions while mantaining the correct position.</p>
<p>We need an anchor point. We choose to fix the polygon position on the actual position of any point of the points array that is not the one that we are dragging.</p>
<p>So having chosen the point, we calculate its actual absolute position:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> absolutePoint <span class="token operator">=</span> fabric<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> fabricObject<span class="token punctuation">.</span>pathOffset<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> fabricObject<span class="token punctuation">.</span>pathOffset<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  fabricObject<span class="token punctuation">.</span><span class="token function">calcTransformMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>We will use this absolute position after we have modified the polygon.</p>
<p>Then we swap the dragged point with the new one, we recalculate the width/height and pathOffset of the polygon ( basically we reinitialize its dimensions ).</p>
<p>Now to keep its position steady, we want to know the point that represent the anchor point, in what position is now relative to polygon size.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> newX <span class="token operator">=</span> <span class="token punctuation">(</span>fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> fabricObject<span class="token punctuation">.</span>pathOffset<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> fabricObject<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
  newY <span class="token operator">=</span> <span class="token punctuation">(</span>fabricObject<span class="token punctuation">.</span>points<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> fabricObject<span class="token punctuation">.</span>pathOffset<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> fabricObject<span class="token punctuation">.</span>height</code></pre></div>
<p>Now newX and newY represent the point position with a range from -0.5 to 0.5 for X and Y.
Fabric supports numeric origins for objects with a range from 0 to 1. This let us use the relative position as an origin to translate the old absolutePoint we find before.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">fabricObject<span class="token punctuation">.</span><span class="token function">setPositionByOrigin</span><span class="token punctuation">(</span>absolutePoint<span class="token punctuation">,</span> newX <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span> newY <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="creating-the-control" style="position:relative;">Creating the control<a href="#creating-the-control" aria-label="creating the control permalink" class="anchor after"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<div
  class="codepen-later"
  data-editable="true"
  data-height="600"
  data-default-tab="result"
  data-prefill='{
    "scripts": "https://unpkg.com/fabric@4.0.0-rc.1/dist/fabric.js"
  }'
>
<pre data-lang="css" data-options-autoprefixer="true">
  .controls {
  	display: inline-block;
  }
</pre>
<pre data-lang="html">
  <div class="controls">
    <p>
      <button id="edit" onclick="Edit()">Toggle editing polygon</button>
    </p>
  </div>
  <canvas id="c" width="500" height="400" style="border:1px solid #ccc"></canvas>
</pre>
<pre data-lang="js">
	var canvas = this.__canvas = new fabric.Canvas('c');
	// create a polygon object
	var points = [{
		x: 3, y: 4
	}, {
		x: 16, y: 3
	}, {
		x: 30, y: 5
	},  {
		x: 25, y: 55
	}, {
		x: 19, y: 44
	}, {
		x: 15, y: 30
	}, {
		x: 15, y: 55
	}, {
		x: 9, y: 55
	}, {
		x: 6, y: 53
	}, {
		x: -2, y: 55
	}, {
		x: -4, y: 40
	}, {
		x: 0, y: 20
	}]
	var polygon = new fabric.Polygon(points, {
		left: 100,
		top: 50,
		fill: '#D81B60',
		strokeWidth: 4,
    stroke: 'green',
		scaleX: 4,
		scaleY: 4,
		objectCaching: false,
		transparentCorners: false,
		cornerColor: 'blue',
	});
  canvas.viewportTransform = [0.7, 0, 0, 0.7, -50, 50];
	canvas.add(polygon);

	// define a function that can locate the controls.
	// this function will be used both for drawing and for interaction.
	function polygonPositionHandler(dim, finalMatrix, fabricObject) {
	  var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),
		    y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);
		return fabric.util.transformPoint(
			{ x: x, y: y },
      fabric.util.multiplyTransformMatrices(
        fabricObject.canvas.viewportTransform,
        fabricObject.calcTransformMatrix()
      )
		);
	}

	// define a function that will define what the control does
	// this function will be called on every mouse move after a control has been
	// clicked and is being dragged.
	// The function receive as argument the mouse event, the current trasnform object
	// and the current position in canvas coordinate
	// transform.target is a reference to the current object being transformed,
	function actionHandler(eventData, transform, x, y) {
		var polygon = transform.target,
		    currentControl = polygon.controls[polygon.__corner],
		    mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),
        polygonBaseSize = polygon._getNonTransformedDimensions(),
				size = polygon._getTransformedDimensions(0, 0),
				finalPointPosition = {
					x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,
					y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y
				};
		polygon.points[currentControl.pointIndex] = finalPointPosition;
		return true;
	}

  // define a function that can keep the polygon in the same position when we change its
  // width/height/top/left.
  function anchorWrapper(anchorIndex, fn) {
    return function(eventData, transform, x, y) {
      var fabricObject = transform.target,
          absolutePoint = fabric.util.transformPoint({
              x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),
              y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),
          }, fabricObject.calcTransformMatrix()),
          actionPerformed = fn(eventData, transform, x, y),
          newDim = fabricObject._setPositionDimensions({}),
          polygonBaseSize = fabricObject._getNonTransformedDimensions(),
          newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,
  		    newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;
      fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);
      return actionPerformed;
    }
  }

	function Edit() {
		// clone what are you copying since you
		// may want copy and paste on different moment.
		// and you do not want the changes happened
		// later to reflect on the copy.
		var poly = canvas.getObjects()[0];
		canvas.setActiveObject(poly);
		poly.edit = !poly.edit;
		if (poly.edit) {
      var lastControl = poly.points.length - 1;
      poly.cornerStyle = 'circle';
      poly.cornerColor = 'rgba(0,0,255,0.5)';
	    poly.controls = poly.points.reduce(function(acc, point, index) {
				acc['p' + index] = new fabric.Control({
					positionHandler: polygonPositionHandler,
					actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),
					actionName: 'modifyPoligon',
					pointIndex: index
				});
				return acc;
			}, { });
		} else {
      poly.cornerColor = 'blue';
      poly.cornerStyle = 'rect';
			poly.controls = fabric.Object.prototype.controls;
		}
		poly.hasBorders = !poly.edit;
		canvas.requestRenderAll();
	}
</pre>
</div></article><a class="github-edit-link" target="_blank" rel="noreferrer" href="https://github.com/fabricjs/fabricjs.github.io/tree/development/src/content/demo/custom-controls-polygon/index.md">Edit this page on Github</a><nav id="prevNextPostLinks"><ul><li class="prevPost"><a href="/demo/custom-controls/">Custom controls</a></li><li class="nextPost"><a href="/demo/events-inspector/">Events inspector</a></li></ul></nav></main><footer>Copyright text and sitelinks here</footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/demo/custom-controls-polygon/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-7a43c6f3fd45d6d3900d.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-8904cb228d222be1c3b9.js\"],\"component---src-pages-customize-build-index-js\":[\"/component---src-pages-customize-build-index-js-a44f1ac3cf92409af593.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-62ccbbcbf315b4af4e34.js\"],\"component---src-pages-support-js\":[\"/component---src-pages-support-js-7e5cf1997601f6ffbcd6.js\"],\"component---src-pages-team-js\":[\"/component---src-pages-team-js-dccb21f9ca9d934609d5.js\"],\"component---src-pages-tests-svg-import-index-jsx\":[\"/component---src-pages-tests-svg-import-index-jsx-ddf559a0e7dfc72b63e2.js\"],\"component---src-templates-demo-jsx\":[\"/component---src-templates-demo-jsx-4cb8b55b07ec13a49134.js\"],\"component---src-templates-demos-jsx\":[\"/component---src-templates-demos-jsx-9959747f62f3c10816c7.js\"],\"component---src-templates-doc-jsx\":[\"/component---src-templates-doc-jsx-82083ff175a684dc52c6.js\"],\"component---src-templates-docs-jsx\":[\"/component---src-templates-docs-jsx-7dc019a200e621927149.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="31ac25f8635694afeccb";</script><script src="/webpack-runtime-88c1f12dc2b80b2b74db.js" async></script><script src="/framework-f64cad4c45f2765d83d9.js" async></script><script src="/app-7a43c6f3fd45d6d3900d.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>